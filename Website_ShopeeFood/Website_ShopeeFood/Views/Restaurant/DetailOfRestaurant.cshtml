@model List<Website_ShopeeFood.Models.ItemsModel>
@{
    ViewData["Title"] = "DetailOfRestaurant";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link rel="stylesheet" href="/css/Details.css">
<link rel="stylesheet" href="/css/StyleList.css">
<link rel="stylesheet" href="/css/StyleForHomePage.css">
<link rel="stylesheet" href="/css/BodyForHomePage.css">
<link rel="stylesheet" href="/css/ContentForHomePage.css">
<link rel="stylesheet" href="/css/Login.css">
<link rel="stylesheet" href="/css/Footer.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>

<div class="now-details-restaurant">
    <div id="Detail_Restaurant" class="container">
        @*-----------------------------------*@

    </div>
</div>

<div class="container relative clearfix">
    <div class="now-menu-restaurant">
        <div class="tab">
            <div class="item">
                Thực Đơn
            </div>
        </div>

        <div class="content">
            <div class="menu-content">
                <div class="category">
                    <div class="list-category">
                        <div class="scrollbar-container">
                            @*-----------------------------------*@

                            <div class="item-content">
                                Món Chính
                            </div>


                        </div>
                    </div>
                </div>
                <div class="menu-details">
                    <div class="promotions">
                        <div class="promotion-item">
                            <div>
                                <img class="icon-promotion" src="https://images.foody.vn/icon/discount/s/shopeefood_voucher_14.png" alt="Thanh toán thẻ tín dụng Sacombank: Giảm 30K cho đơn từ 100K vào thứ hai mỗi tuần">
                                <div class="content-promotion">Thanh toán thẻ tín dụng Sacombank: Giảm 30K cho đơn từ 100K vào thứ hai mỗi tuần</div>
                            </div>
                        </div>
                        <button class="code-copy">
                            <span>Copy Code</span>
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="menu-restaurant-list">
                        <div class="search-item">
                            <p class="input-group">
                                <i class="fa fa-search" aria-hidden="true"></i>
                                <input id="find-food" type="text" placeholder="tìm món">
                            </p>
                        </div>
                    </div>
                    <div aria-label="grid" aria-readonly="true" role="grid" tabindex="0" style="box-sizing: border-box; direction: ltr; height: auto; position: relative; width: 558px; will-change: transform; overflow: auto; outline: none;">
                        <div class="ReactVirtualized__Grid__innerScrollContainer myheight" role="rowgroup" style="width: auto; height: 4509px; max-width: 558px; max-height: 723px; overflow-x: hidden; overflow-y: scroll; position: relative;">
                            <div class="menu-group" id="section-group-menu-2648835" style="height: 56px; left: 0px; position: absolute; top: 0px; width: 100%;">
                                <div class="title-menu">MÓN CHÍNH</div>
                            </div>
                            <div id="Food_PartialView">
                                @*-----------------------------------*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="cart">
    <div class="header-cart">
        <div class="text">
            <span>1 phần - 1 người</span>
        </div>
        <div class="options-cart">
            <div class="option-item">
                <button class="btn">Nhóm cùng đặt</button>
            </div>
            <div class="reset">
                <button class="btn btn-reset" href="resetTheMenu">Reset</button>
            </div>
        </div>
    </div>
    @if (Model != null)
    {
        int i = 0;
        <div class="cart-info">
            <div class="img-user">
                <img src=@ViewBag.ImgaeUser>
                <div class="name-user">
                    @ViewBag.NameUser
                </div>
                <div class="count-number">
                    @i Món
                </div>
            </div>
        </div>

        <div class="list-food">


            @foreach (var item in Model)
            {
                i++;
                <div class="list-food-item">
                    <button class="minusbtn" id="minus" onclick="reduceNumber(@item.Food.FoodId)">-</button>
                    <span class="number-products" id="numberPlace">@item.Quantity</span>
                    <button class="plusbtn" id="plus" onclick="addNumber(@item.Food.FoodId)">+</button>
                    <div class="name-of-products">
                        <span class="name" style="overflow-x:hidden;">@item.Food.NameofFood</span>
                        <span id="item-price" class="prices">@item.Food.Price</span>
                    </div>
                </div>
            }

        </div>
    }
    @if (Model != null)
    {
        double total = 0;
        double fees = 10000;
        double ttInvoices = 0;

        <div class="total">
            <div class="total-price">
                <span class="text">
                    Cộng
                </span>


                @foreach (var item2 in Model)
                {
                    total = total + (item2.Food.Price * item2.Quantity);
                }

                <input type="text" value="@total" style="border: none; text-align: center; margin-left: 70px; margin: 5px; margin-left: 49px; text-align: right;" />

            </div>
            <div class="total-price">
                <span class="text">
                    Phí vận chuyển (Est.)
                </span>
                <span class="prices">
                    10,000đ/km
                </span>
            </div>
        </div>
        <div class="prepare-to-order">
            <div class="temporary-prices">
                <span class="text">Tạm tính</span>
                <span class="prices">
                    @{
                        ttInvoices = total + fees;
                    }
                    @ttInvoices
                </span>
            </div>
            <div class="btn-Order">
                <button type="button" class="btn" data-toggle="modal" data-target="#exampleModal">Đặt Trước</button>
            </div>
        </div>
    }
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document" style="max-width: 1150px;">
        @if (Model != null)
        {
            double total = 0;
            double fees = 10000;
            double ttInvoices = 0;
            int i = 0;
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Xác nhận đơn hàng</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">X</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="content">
                        <div class="content-left" style="float:left;">
                            <div class="google-maps" style="width: 350px; height: 350px;">
                                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1959.6977493463517!2d106.70496832472143!3d10.780990321459603!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752f492b78ffff%3A0xdf1209cdf8c48b63!2sShopeefood!5e0!3m2!1svi!2s!4v1667898560169!5m2!1svi!2s" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                            </div>
                            <div class="address">
                                <div class="gps">
                                    <div class="circle"></div>
                                    <div class="name">@ViewBag.NameUser</div>
                                    <div class="address-user">TP.HCM</div>
                                </div>
                            </div>
                            <div class="change-address">
                                <div class="text" style="font-size: 19px; font-weight: 700;">
                                    Thay đổi thông tin đơn hàng
                                </div>
                                <div class="pointer">&#8594;</div>
                            </div>
                        </div>
                        <div class="content-right">
                            <div class="details-invoices">
                                <span class="text" style="font-size: 19px; margin-left: -20px; font-weight: 700;">Chi tiết đơn hàng</span>
                                <span class="pointer">></span>
                            </div>

                            @foreach (var item in Model)
                            {
                                i++;
                                <div class="item-producs">
                                    <div class="number-products" style="padding: 0 11px;">
                                        @item.Quantity
                                    </div>
                                    <div class="name-products">
                                        @item.Food.NameofFood
                                    </div>
                                    <div class="price-product">
                                        @item.Food.Price đ
                                    </div>
                                </div>
                                total = total + (item.Food.Price * item.Quantity);
                            }

                            <div class="plus-prices">
                                <div class="total-prices">
                                    <span class="text" style="font-size: 19px; margin-left: -20px; font-weight: 700;">
                                        Tổng <span class="numbers">@i</span> món
                                    </span>
                                    <span class="prices" style="font-weight: 700; font-size: 18px;">@total đ</span>
                                </div>

                                <div class="fees" style="padding: 17px 0;">
                                    <span class="text" style="margin-left: -20px;">
                                        Phí vận chuyển:
                                    </span>
                                    <span class="prices">10,000 đ</span>
                                </div>
                            </div>

                            <div class="curent-prices" style="padding: 11px 0px;">
                                <div class="text" style="font-size: 19px; margin-left: -20px; font-weight: 700;">
                                    Tạm tính
                                </div>

                                <div class="price" style="font-size: 19px; margin-left: -20px; font-weight: 700; margin-right: 22px; text-align: right; padding: 15px 0px;">
                                    @{
                                        ttInvoices = total + fees;
                                    }
                                    @ttInvoices đ
                                </div>

                            </div>

                            <div class="payment-method">
                                <div class="text" style="font-size: 19px; margin-left: -20px; font-weight: 700;">
                                    Thanh toán bằng tiền mặt
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="justify-content: center;">
                    <div class="complete-payment" style="width: 100%;">
                        <div class="button-payment">
                            <a class="btn" href="~/Invoices/addNewInvoices?totalPrice=@ttInvoices">
                                Hoàn tất đơn hàng &nbsp;
                                <i class="fas fa-angle-right"></i> &nbsp;
                                <span class="final-money">
                                    @ttInvoices đ
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script>
    $('#Detail_Restaurant').load('/Restaurant/GetRestaurantByID')
    $('#Food_PartialView').load('/Food/TypesofFoods_Partial')
</script>

<script>
    function reduceNumber(foodId)
    {
        $.ajax({
            type: "GET",
            url: "reduceNumberOfIdFood?foodId="+ foodId +"",
            success: function () {
                window.location = "@Url.Action("DetailOfRestaurant","Restaurant")";
            }
        });
    }

    function addNumber(foodId)
    {
        $.ajax({
            type: "GET",
            url: "addNumberOfIdFood?foodId=" + foodId + "",
            success: function()
            {
                window.location = "@Url.Action("DetailOfRestaurant","Restaurant")";
            }
        });
    }
</script>

<script>
    $(document).ready(function(){
        $("#find-food").keyup(function(){
            var nameOfFood = $("#find-food").val();
            if(nameOfFood.length > 0)
            {
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("searchingOfFood", "Food")",
                    data: {"nameOfFood": nameOfFood},
                    success: function(respone){
                        $('#Food_PartialView').load('/Food/TypesofFoods_Partial')
                    }
                });
            }
            else
            {
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("resetTheListFood", "Food")",
                    success: function(respone){
                        $('#Food_PartialView').load('/Food/TypesofFoods_Partial')
                    }
                });
            }
        });
    });
</script>

<script>
    const element = document.getElementsByClassName('item-restaurant-row').lastChild;
    const heightMax = element.style.height;

    var heightInList = document.getElementsByClassName('myheight');

    heightInList(function (heightMax) {
        $(this).css({ height: (heightMax) + 'px' });
    });
</script>

<script>
    var messageCheckingAccount = "@((string)ViewBag.CheckAccountAddToCart)";

    if (messageCheckingAccount != null && messageCheckingAccount != "") {
        swal({
            title: "Thông Báo",
            text: messageCheckingAccount,
            icon: "success",
        });
    }
</script>